#
# The rules are generated from the Sigma GitHub repository at https://github.com/SigmaHQ/sigma
# Follow these steps to get the latest rules from the repository with Python
#    1. Clone the repository locally
#    2. Using a commandline, change working directory to the just cloned repository
#    3. Run sigmac -I --target uberagent -r rules/
#
# The rules in this file are marked with sigma-level: low
#

[ActivityMonitoringRule]
# Detects enumeration of local or remote network services.
RuleName = MacOS Network Service Scanning
EventType = Process.Start
Tag = proc-start-macos-network-service-scanning
RiskScore = 25
Query = (((Process.Path like r"%/nc" or Process.Path like r"%/netcat") and not (Process.CommandLine like r"%l%")) or (Process.Path like r"%/nmap" or Process.Path like r"%/telnet"))

[ActivityMonitoringRule]
# Detects attempts to use system dialog prompts to capture user credentials
RuleName = GUI Input Capture - macOS
EventType = Process.Start
Tag = proc-start-gui-input-capture-macos
RiskScore = 25
Query = (Process.Path == "/usr/sbin/osascript" and Process.CommandLine like r"%-e%" and Process.CommandLine like r"%display%" and Process.CommandLine like r"%dialog%" and Process.CommandLine like r"%answer%" and (Process.CommandLine like r"%admin%" or Process.CommandLine like r"%administrator%" or Process.CommandLine like r"%authenticate%" or Process.CommandLine like r"%authentication%" or Process.CommandLine like r"%credentials%" or Process.CommandLine like r"%pass%" or Process.CommandLine like r"%password%" or Process.CommandLine like r"%unlock%"))

[ActivityMonitoringRule]
# Detects attempts to use screencapture to collect macOS screenshots
RuleName = Screen Capture - macOS
EventType = Process.Start
Tag = proc-start-screen-capture-macos
RiskScore = 25
Query = Process.Path == "/usr/sbin/screencapture"

[ActivityMonitoringRule]
# Detects attempts to masquerade as legitimate files by adding a space to the end of the filename.
RuleName = Space After Filename - macOS
EventType = Process.Start
Tag = proc-start-space-after-filename-macos
RiskScore = 25
Query = (Process.CommandLine like r"% " or Process.Path like r"% ")

[ActivityMonitoringRule]
# Detects enumeration of local systeam accounts on MacOS
RuleName = Local System Accounts Discovery - MacOs
EventType = Process.Start
Tag = proc-start-local-system-accounts-discovery-macos
RiskScore = 25
Query = ((Process.Path like r"%/dscl" and Process.CommandLine like r"%list%" and Process.CommandLine like r"%/users%") or (Process.Path like r"%/dscacheutil" and Process.CommandLine like r"%-q%" and Process.CommandLine like r"%user%") or Process.CommandLine like r"%'x:0:'%" or (Process.Path like r"%/cat" and (Process.CommandLine like r"%/etc/passwd%" or Process.CommandLine like r"%/etc/sudoers%")) or Process.Path like r"%/id" or (Process.Path like r"%/lsof" and Process.CommandLine like r"%-u%"))

[ActivityMonitoringRule]
# Detects macOS Gatekeeper bypass via xattr utility
RuleName = Gatekeeper Bypass via Xattr
EventType = Process.Start
Tag = proc-start-gatekeeper-bypass-via-xattr
RiskScore = 25
Query = (Process.Path like r"%/xattr" and Process.CommandLine like r"%-r%" and Process.CommandLine like r"%com.apple.quarantine%")

[ActivityMonitoringRule]
# Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system.
RuleName = Creation Of A Local User Account
EventType = Process.Start
Tag = proc-start-creation-of-a-local-user-account
RiskScore = 25
Query = (Process.Path like r"%/dscl" and Process.CommandLine like r"%create%")

[ActivityMonitoringRule]
# Detects usage of base64 utility to decode arbitrary base64-encoded text
RuleName = Decode Base64 Encoded Text -MacOs
EventType = Process.Start
Tag = proc-start-decode-base64-encoded-text-macos
RiskScore = 25
Query = (Process.Path == "/usr/bin/base64" and Process.CommandLine like r"%-d%")

[ActivityMonitoringRule]
# Detection use of the command "split" to split files into parts and possible transfer.
RuleName = Split A File Into Pieces
EventType = Process.Start
Tag = proc-start-split-a-file-into-pieces
RiskScore = 25
Query = Process.Path like r"%/split"

[ActivityMonitoringRule]
# A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture.
RuleName = Suspicious System.Drawing Load
EventType = Image.Load
Tag = suspicious-system.drawing-load
RiskScore = 25
Query = (Image.Path like r"%\\System.Drawing.ni.dll" and not (((Process.Path like r"C:\\Program Files\\%" or Process.Path like r"C:\\Program Files (x86)\\%" or Process.Path like r"C:\\Windows\\System32\\%" or Process.Path like r"C:\\Windows\\Microsoft.NET\\%" or Process.Path like r"C:\\Windows\\ImmersiveControlPanel\\%")) or (Process.Path like r"C:\\Windows\\System32\\NhNotifSys.exe") or (Process.Path like r"C:\\Users\\%" and (Process.Path like r"%\\AppData\\Local\\NhNotifSys\\nahimic\\nahimicNotifSys.exe" or Process.Path like r"%\\GitHubDesktop\\Update.exe"))))
GenericProperty1 = Image.Path

[ActivityMonitoringRule]
# Detects PsExec service execution via default service image name
RuleName = PsExec Tool Execution
EventType = Process.Start
Tag = proc-start-psexec-tool-execution
RiskScore = 25
Query = (Process.Path like r"%\\PSEXESVC.exe" and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%"))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Detects a windows service to be stopped
RuleName = Stop Windows Service
EventType = Process.Start
Tag = proc-start-stop-windows-service
RiskScore = 25
Query = ((((Process.Name in ["sc.exe", "net.exe", "net1.exe"] or (Process.Path like r"%\\sc.exe" or Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe")) and Process.CommandLine like r"% stop %") and not (Process.CommandLine in ["sc  stop KSCWebConsoleMessageQueue", "sc  stop LGHUBUpdaterService"] and (Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%"))) or ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and Process.CommandLine like r"%Stop-Service %"))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.
RuleName = Change Default File Association
EventType = Process.Start
Tag = proc-start-change-default-file-association
RiskScore = 25
Query = (Process.CommandLine like r"%cmd%" and Process.CommandLine like r"%assoc%" and (Process.CommandLine like r"% /c %" or Process.CommandLine like r"% /k %" or Process.CommandLine like r"% /r %"))

[ActivityMonitoringRule]
# Detects specific combinations of encoding methods in the PowerShell command lines
RuleName = Encoded PowerShell Command Line
EventType = Process.Start
Tag = proc-start-encoded-powershell-command-line
RiskScore = 25
Query = ((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") and (((Process.CommandLine like r"%ToInt%" or Process.CommandLine like r"%ToDecimal%" or Process.CommandLine like r"%ToByte%" or Process.CommandLine like r"%ToUint%" or Process.CommandLine like r"%ToSingle%" or Process.CommandLine like r"%ToSByte%") and (Process.CommandLine like r"%ToChar%" or Process.CommandLine like r"%ToString%" or Process.CommandLine like r"%String%")) or ((Process.CommandLine like r"%char%" and Process.CommandLine like r"%join%") or (Process.CommandLine like r"%split%" and Process.CommandLine like r"%join%"))))

[ActivityMonitoringRule]
# Use of hostname to get information
RuleName = Suspicious Execution of Hostname
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-hostname
RiskScore = 25
Query = Process.Path like r"%\\HOSTNAME.EXE"

[ActivityMonitoringRule]
# Detect indirect command execution via Program Compatibility Assistant pcwrun.exe
RuleName = Indirect Command Execution By Program Compatibility Wizard
EventType = Process.Start
Tag = proc-start-indirect-command-execution-by-program-compatibility-wizard
RiskScore = 25
Query = Parent.Path like r"%\\pcwrun.exe"
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects use of redirection character ">" to redicrect information in commandline
RuleName = Redirect Output in CommandLine
EventType = Process.Start
Tag = proc-start-redirect-output-in-commandline
RiskScore = 25
Query = (((Process.Name == "Cmd.Exe" or Process.Path like r"%\\cmd.exe") and Process.CommandLine like r"%>%") and not (((Process.CommandLine like r"%C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe%" or Process.CommandLine like r"%chrome-extension://%" or Process.CommandLine like r"%\\.\\pipe\\chrome.nativeMessaging%"))))

[ActivityMonitoringRule]
# Detects usage of attrib.exe to hide files from users.
RuleName = Hiding Files with Attrib.exe
EventType = Process.Start
Tag = proc-start-hiding-files-with-attrib.exe
RiskScore = 25
Query = (((Process.Path like r"%\\attrib.exe" or Process.Name == "ATTRIB.EXE") and Process.CommandLine like r"% +h %") and not ((Process.CommandLine like r"%\\desktop.ini %") or (Parent.Path like r"%\\cmd.exe" and Process.CommandLine like r"+R +H +S +A \\\*.cui" and Parent.CommandLine like r"C:\\WINDOWS\\system32\\\*.bat")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Local accounts, System Owner/User discovery using operating systems utilities
RuleName = Local Accounts Discovery
EventType = Process.Start
Tag = proc-start-local-accounts-discovery
RiskScore = 25
Query = (((Process.Path like r"%\\cmd.exe" and Process.CommandLine like r"% /c%" and Process.CommandLine like r"%dir %" and Process.CommandLine like r"%\\Users\\%") and not (Process.CommandLine like r"% rmdir %")) or (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"%user%") and not ((Process.CommandLine like r"%/domain%" or Process.CommandLine like r"%/add%" or Process.CommandLine like r"%/delete%" or Process.CommandLine like r"%/active%" or Process.CommandLine like r"%/expires%" or Process.CommandLine like r"%/passwordreq%" or Process.CommandLine like r"%/scriptpath%" or Process.CommandLine like r"%/times%" or Process.CommandLine like r"%/workstations%"))) or (Process.Path like r"%\\whoami.exe" or Process.Path like r"%\\quser.exe" or Process.Path like r"%\\qwinsta.exe") or (Process.Path like r"%\\wmic.exe" and Process.CommandLine like r"%useraccount%" and Process.CommandLine like r"%get%") or (Process.Path like r"%\\cmdkey.exe" and Process.CommandLine like r"% /l%"))

[ActivityMonitoringRule]
# Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool.
RuleName = Windows Network Enumeration
EventType = Process.Start
Tag = proc-start-windows-network-enumeration
RiskScore = 25
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"%view%") and not (Process.CommandLine like r"%\\\\\*"))

[ActivityMonitoringRule]
# Adversaries may attempt to find local system groups and permission settings.
# The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.
# Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.
RuleName = Suspicious Get Local Groups Information with WMIC
EventType = Process.Start
Tag = proc-start-suspicious-get-local-groups-information-with-wmic
RiskScore = 25
Query = ((Process.Path like r"%\\wmic.exe" or Process.Name == "wmic.exe") and Process.CommandLine like r"% group%")

[ActivityMonitoringRule]
# Detects usage of the "systeminfo" command to retrieve information
RuleName = Suspicious Execution of Systeminfo
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-systeminfo
RiskScore = 25
Query = (Process.Path like r"%\\systeminfo.exe" or Process.Name == "sysinfo.exe")

[ActivityMonitoringRule]
# Detect suspicious parent processes of well-known Windows processes
RuleName = Windows Processes Suspicious Parent Directory
EventType = Process.Start
Tag = proc-start-windows-processes-suspicious-parent-directory
RiskScore = 25
Query = ((Process.Path like r"%\\svchost.exe" or Process.Path like r"%\\taskhost.exe" or Process.Path like r"%\\lsm.exe" or Process.Path like r"%\\lsass.exe" or Process.Path like r"%\\services.exe" or Process.Path like r"%\\lsaiso.exe" or Process.Path like r"%\\csrss.exe" or Process.Path like r"%\\wininit.exe" or Process.Path like r"%\\winlogon.exe") and not (((Parent.Path like r"%\\SavService.exe" or Parent.Path like r"%\\ngen.exe") or (Parent.Path like r"%\\System32\\%" or Parent.Path like r"%\\SysWOW64\\%")) or ((Parent.Path like r"%\\Windows Defender\\%" or Parent.Path like r"%\\Microsoft Security Client\\%") and Parent.Path like r"%\\MsMpEng.exe") or (Parent.Path == '' or Parent.Path == "-")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Marks a file as a system file using the attrib.exe utility
RuleName = Set Windows System File with Attrib
EventType = Process.Start
Tag = proc-start-set-windows-system-file-with-attrib
RiskScore = 25
Query = ((Process.Path like r"%\\attrib.exe" or Process.Name == "ATTRIB.EXE") and Process.CommandLine like r"% +s %")

[ActivityMonitoringRule]
# Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation
RuleName = Mounted Share Deleted
EventType = Process.Start
Tag = proc-start-mounted-share-deleted
RiskScore = 25
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"%share%" and Process.CommandLine like r"%/delete%"))

[ActivityMonitoringRule]
# Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.
RuleName = Detect Virtualbox Driver Installation OR Starting Of VMs
EventType = Process.Start
Tag = proc-start-detect-virtualbox-driver-installation-or-starting-of-vms
RiskScore = 25
Query = ((Process.CommandLine like r"%VBoxRT.dll,RTR3Init%" or Process.CommandLine like r"%VBoxC.dll%" or Process.CommandLine like r"%VBoxDrv.sys%") or (Process.CommandLine like r"%startvm%" or Process.CommandLine like r"%controlvm%"))

[ActivityMonitoringRule]
# An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.
RuleName = Data Compressed - rar.exe
EventType = Process.Start
Tag = proc-start-data-compressed-rar.exe
RiskScore = 25
Query = (Process.Path like r"%\\rar.exe" and Process.CommandLine like r"% a %")

[ActivityMonitoringRule]
# Detects the creation of scheduled tasks in user session
RuleName = Scheduled Task Creation
EventType = Process.Start
Tag = proc-start-scheduled-task-creation
RiskScore = 25
Query = ((Process.Path like r"%\\schtasks.exe" and Process.CommandLine like r"% /create %") and not ((Process.User like r"%AUTHORI%" or Process.User like r"%AUTORI%")))
GenericProperty1 = Process.User

[ActivityMonitoringRule]
# Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.
RuleName = Network Sniffing
EventType = Process.Start
Tag = proc-start-network-sniffing
RiskScore = 25
Query = ((Process.Path like r"%\\tshark.exe" and Process.CommandLine like r"%-i%") or Process.Path like r"%\\windump.exe")

[ActivityMonitoringRule]
# Adversaries may delete files left behind by the actions of their intrusion activity.
# Malware, tools, or other non-native files dropped or created on a system by an adversary may leave traces to indicate to what was done within a network and how.
# Removal of these files can occur during an intrusion, or as part of a post-intrusion process to minimize the adversary's footprint.
RuleName = Windows Cmd Delete File
EventType = Process.Start
Tag = proc-start-windows-cmd-delete-file
RiskScore = 25
Query = ((Process.CommandLine like r"% del %" and Process.CommandLine like r"%/f%") or (Process.CommandLine like r"%rmdir%" and Process.CommandLine like r"%/s%" and Process.CommandLine like r"%/q%"))

[ActivityMonitoringRule]
# Detects manual service execution (start) via system utilities.
RuleName = Service Execution
EventType = Process.Start
Tag = proc-start-service-execution
RiskScore = 25
Query = ((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"% start %")

[ActivityMonitoringRule]
# Attackers may leverage fsutil to enumerated connected drives.
RuleName = Fsutil Drive Enumeration
EventType = Process.Start
Tag = proc-start-fsutil-drive-enumeration
RiskScore = 25
Query = ((Process.Path like r"%\\fsutil.exe" or Process.Name == "fsutil.exe") and Process.CommandLine like r"%drives%")

[ActivityMonitoringRule]
# Adversaries may attempt to get information about running processes on a system. Information obtained could be used to gain an understanding of common software/applications running on systems within the network
RuleName = Suspicious Tasklist Discovery Command
EventType = Process.Start
Tag = proc-start-suspicious-tasklist-discovery-command
RiskScore = 25
Query = (Process.CommandLine like r"%tasklist%" or Process.Path like r"%\\tasklist.exe" or Process.Name == "tasklist.exe")

[ActivityMonitoringRule]
# Adversaries may enumerate browser bookmarks to learn more about compromised hosts.
# Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about
# internal network resources such as servers, tools/dashboards, or other related infrastructure.
RuleName = Suspicious Where Execution
EventType = Process.Start
Tag = proc-start-suspicious-where-execution
RiskScore = 25
Query = ((Process.Path like r"%\\where.exe" or Process.Name == "where.exe") and (Process.CommandLine like r"%places.sqlite%" or Process.CommandLine like r"%cookies.sqlite%" or Process.CommandLine like r"%formhistory.sqlite%" or Process.CommandLine like r"%logins.json%" or Process.CommandLine like r"%key4.db%" or Process.CommandLine like r"%key3.db%" or Process.CommandLine like r"%sessionstore.jsonlz4%" or Process.CommandLine like r"%History%" or Process.CommandLine like r"%Bookmarks%" or Process.CommandLine like r"%Cookies%" or Process.CommandLine like r"%Login Data%"))

[ActivityMonitoringRule]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
RuleName = Suspicious Network Command
EventType = Process.Start
Tag = proc-start-suspicious-network-command
RiskScore = 25
Query = (Process.CommandLine like r"%ipconfig /all%" or Process.CommandLine like r"%netsh interface show interface%" or Process.CommandLine like r"%arp -a%" or Process.CommandLine like r"%nbtstat -n%" or Process.CommandLine like r"%net config%" or Process.CommandLine like r"%route print%")

[ActivityMonitoringRule]
# Detects suspicious process that use escape characters
RuleName = Suspicious Commandline Escape
EventType = Process.Start
Tag = proc-start-suspicious-commandline-escape
RiskScore = 25
Query = (Process.CommandLine like r"%h^t^t^p%" or Process.CommandLine like r"%h\"t\"t\"p%")

[ActivityMonitoringRule]
# Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server.
RuleName = Suspicious Execution of Taskkill
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-taskkill
RiskScore = 25
Query = ((Process.Path like r"%\\taskkill.exe" or Process.Name == "taskkill.exe") and (Process.CommandLine like r"% /f%" and Process.CommandLine like r"% /im %"))

[ActivityMonitoringRule]
# Detects the usage of Sysinternals Tools due to accepteula option being seen in the command line.
RuleName = Usage of Sysinternals Tools
EventType = Process.Start
Tag = proc-start-usage-of-sysinternals-tools
RiskScore = 25
Query = (Process.CommandLine like r"% -accepteula%" or Process.CommandLine like r"% /accepteula%")

[ActivityMonitoringRule]
# Detects usage of the "dir" command that's part of windows batch/cmd to collect information about directories
RuleName = Suspicious DIR Execution
EventType = Process.Start
Tag = proc-start-suspicious-dir-execution
RiskScore = 25
Query = (Process.CommandLine like r"%dir %" and Process.CommandLine like r"% /s%" and Process.CommandLine like r"% /b%")

[ActivityMonitoringRule]
# Use of reg to get MachineGuid information
RuleName = Suspicious Query of MachineGUID
EventType = Process.Start
Tag = proc-start-suspicious-query-of-machineguid
RiskScore = 25
Query = (Process.Path like r"%\\reg.exe" and Process.CommandLine like r"%SOFTWARE\\Microsoft\\Cryptography%" and Process.CommandLine like r"%/v %" and Process.CommandLine like r"%MachineGuid%")

[ActivityMonitoringRule]
# Detects execution of Net.exe, whether suspicious or benign.
RuleName = Net.exe Execution
EventType = Process.Start
Tag = proc-start-net.exe-execution
RiskScore = 25
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") or Process.Name in ["net.exe", "net1.exe"]) and (Process.CommandLine like r"% group%" or Process.CommandLine like r"% localgroup%" or Process.CommandLine like r"% user%" or Process.CommandLine like r"% view%" or Process.CommandLine like r"% share%" or Process.CommandLine like r"% accounts%" or Process.CommandLine like r"% stop %" or Process.CommandLine like r"% start%"))

[ActivityMonitoringRule]
# Adversaries may interact with the Windows Registry to gather information about credentials, the system, configuration, and installed software.
RuleName = Query Registry
EventType = Process.Start
Tag = proc-start-query-registry
RiskScore = 25
Query = (Process.Path like r"%\\reg.exe" and (Process.CommandLine like r"%query%" or Process.CommandLine like r"%save%" or Process.CommandLine like r"%export%") and (Process.CommandLine like r"%currentVersion\\windows%" or Process.CommandLine like r"%winlogon\\%" or Process.CommandLine like r"%currentVersion\\shellServiceObjectDelayLoad%" or Process.CommandLine like r"%currentVersion\\run%" or Process.CommandLine like r"%currentVersion\\policies\\explorer\\run%" or Process.CommandLine like r"%currentcontrolset\\services%"))

[ActivityMonitoringRule]
# Identifies use of various commands to query a systems time. This technique may be used before executing a scheduled task or to discover the time zone of a target system.
RuleName = Discovery of a System Time
EventType = Process.Start
Tag = proc-start-discovery-of-a-system-time
RiskScore = 25
Query = (((Process.Path like r"%\\net.exe" or Process.Path like r"%\\net1.exe") and Process.CommandLine like r"%time%") or (Process.Path like r"%\\w32tm.exe" and Process.CommandLine like r"%tz%"))

[ActivityMonitoringRule]
# Detects a PsExec service start
RuleName = PsExec Service Start
EventType = Process.Start
Tag = proc-start-psexec-service-start
RiskScore = 25
Query = Process.CommandLine like r"C:\\Windows\\PSEXESVC.exe"

[ActivityMonitoringRule]
# Detects the creation of a process from Windows task manager
RuleName = Taskmgr as Parent
EventType = Process.Start
Tag = proc-start-taskmgr-as-parent
RiskScore = 25
Query = (Parent.Path like r"%\\taskmgr.exe" and not ((Process.Path like r"%\\resmon.exe" or Process.Path like r"%\\mmc.exe" or Process.Path like r"%\\taskmgr.exe")))
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.
RuleName = Suspicious Listing of Network Connections
EventType = Process.Start
Tag = proc-start-suspicious-listing-of-network-connections
RiskScore = 25
Query = (Process.CommandLine like r"%netstat%" or (Process.CommandLine like r"%net %" and ((Process.CommandLine like r"% use" or Process.CommandLine like r"% sessions") or (Process.CommandLine like r"% use %" or Process.CommandLine like r"% sessions %"))))

[ActivityMonitoringRule]
# Adversaries may collect data stored in the clipboard from users copying information within or between applications.
RuleName = Use of CLIP
EventType = Process.Start
Tag = proc-start-use-of-clip
RiskScore = 25
Query = (Process.Path like r"%\\clip.exe" or Process.Name == "clip.exe")

[ActivityMonitoringRule]
# Detects execution of "sc.exe" to query information about registered services on the system
RuleName = SC.EXE Query Execution
EventType = Process.Start
Tag = proc-start-sc.exe-query-execution
RiskScore = 25
Query = (Process.Path like r"%\\sc.exe" and Process.Name like r"%sc.exe" and Process.CommandLine like r"% query%")

[ActivityMonitoringRule]
# Attackers can use explorer.exe for evading defense mechanisms
RuleName = Proxy Execution Via Explorer.exe
EventType = Process.Start
Tag = proc-start-proxy-execution-via-explorer.exe
RiskScore = 25
Query = (Process.Path like r"%\\explorer.exe" and Parent.Path like r"%\\cmd.exe" and Process.CommandLine like r"%explorer.exe%")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# Detects creation of a new service.
RuleName = New Service Creation
EventType = Process.Start
Tag = proc-start-new-service-creation
RiskScore = 25
Query = ((Process.Path like r"%\\sc.exe" and Process.CommandLine like r"%create%" and Process.CommandLine like r"%binPath%") or (Process.CommandLine like r"%New-Service%" and Process.CommandLine like r"%-BinaryPathName%"))

[ActivityMonitoringRule]
# Detects non-interactive PowerShell activity by looking at powershell.exe with a non user process such as "explorer.exe" as a parent.
RuleName = Non Interactive PowerShell Process Spawned
EventType = Process.Start
Tag = proc-start-non-interactive-powershell-process-spawned
RiskScore = 25
Query = (((Process.Path like r"%\\powershell.exe" or Process.Path like r"%\\pwsh.exe") or Process.Name in ["PowerShell.EXE", "pwsh.dll"]) and not (((Parent.Path like r"%\\explorer.exe" or Parent.Path like r"%\\CompatTelRunner.exe") or Parent.Path like r"C:\\$WINDOWS.~BT\\Sources\\SetupHost.exe") or (Parent.Path like r"C:\\Users\\%" and Parent.Path like r"%\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe" and Parent.CommandLine like r"% --ms-enable-electron-run-as-node %")))
GenericProperty1 = Parent.Path
GenericProperty2 = Parent.CommandLine

[ActivityMonitoringRule]
# Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems
RuleName = Suspicious Netsh Discovery Command
EventType = Process.Start
Tag = proc-start-suspicious-netsh-discovery-command
RiskScore = 25
Query = (Process.CommandLine like r"%netsh %" and Process.CommandLine like r"%show %" and Process.CommandLine like r"%firewall %" and (Process.CommandLine like r"%config %" or Process.CommandLine like r"%state %" or Process.CommandLine like r"%rule %" or Process.CommandLine like r"%name=all%"))

[ActivityMonitoringRule]
# Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces
# Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe
RuleName = Malicious Windows Script Components File Execution by TAEF Detection
EventType = Process.Start
Tag = proc-start-malicious-windows-script-components-file-execution-by-taef-detection
RiskScore = 25
Query = (Process.Path like r"%\\te.exe" or Parent.Path like r"%\\te.exe" or Process.Name like r"\\te.exe")
GenericProperty1 = Parent.Path

[ActivityMonitoringRule]
# This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed,
# Usee to Query/modify DNS records for Active Directory integrated DNS via LDAP
RuleName = Suspicious Execution of Adidnsdump
EventType = Process.Start
Tag = proc-start-suspicious-execution-of-adidnsdump
RiskScore = 25
Query = (Process.Path like r"%\\python.exe" and Process.CommandLine like r"%adidnsdump%")

[ActivityMonitoringRule]
# Detects the export of the target Registry key to a file.
RuleName = Exports Registry Key To a File
EventType = Process.Start
Tag = proc-start-exports-registry-key-to-a-file
RiskScore = 25
Query = ((Process.Path like r"%\\regedit.exe" and (Process.CommandLine like r"% /E %" or Process.CommandLine like r"% -E %")) and not (((Process.CommandLine like r"%hklm%" or Process.CommandLine like r"%hkey\_local\_machine%")) and ((Process.CommandLine like r"%\\system" or Process.CommandLine like r"%\\sam" or Process.CommandLine like r"%\\security"))))

